import { router } from '@kit.ArkUI';
import prompt from '@system.prompt';
import { ApiService } from '../../common/services/ApiService';
import { MissingPet, MissingPetStatus } from '../../common/models/MissingPet';
import { UserService } from '../../common/database/UserService';
import { UserInfo } from '../../common/models/UserInfo';

// çŠ¶æ€å¸¸é‡
const STATUS_ALL: string = 'å…¨éƒ¨'
const STATUS_ACTIVE: string = 'å¯»æ‰¾ä¸­'
const STATUS_FOUND: string = 'å·²æ‰¾åˆ°'
const STATUS_CLOSED: string = 'å·²å…³é—­'

// æŒ‰å½“å‰ç™»å½•ç”¨æˆ·æ˜¾ç¤ºå…¶å‘å¸ƒçš„å¯»å® ä¿¡æ¯

@Entry
@Component
struct MyMissingPets {
  @State tabs: string[] = ['å…¨éƒ¨', 'å¯»æ‰¾ä¸­', 'å·²æ‰¾åˆ°', 'å·²å…³é—­']
  @State currentTab: number = 0
  @State isLoading: boolean = true
  @State errorMessage: string = ''
  @State allPosts: MissingPet[] = []
  @State posts: MissingPet[] = []
  
  private apiService: ApiService = ApiService.getInstance()
  private userService: UserService = UserService.getInstance()

  async aboutToAppear(): Promise<void> {
    // æ£€æŸ¥ç™»å½•çŠ¶æ€
    const isLoggedIn = AppStorage.Get('isLoggedIn') as boolean | undefined
    if (!isLoggedIn) {
      prompt.showToast({ message: 'è¯·å…ˆç™»å½•åæŸ¥çœ‹æˆ‘çš„å¯»å® ', duration: 1500 })
      try { 
        router.replaceUrl({ url: 'pages/Auth/Login' }) 
      } catch (_) { 
        router.pushUrl({ url: 'pages/Auth/Login' }) 
      }
      return
    }
    
    await this.loadMyMissingPets()
  }

  onPageShow(): void {
    // é¡µé¢æ˜¾ç¤ºæ—¶åˆ·æ–°æ•°æ®
    this.loadMyMissingPets()
  }

  // åŠ è½½ç”¨æˆ·çš„å¯»å® æ•°æ®
  async loadMyMissingPets(): Promise<void> {
    this.isLoading = true
    this.errorMessage = ''
    
    try {
      const params = router.getParams() as Record<string, number | string | undefined> | undefined
      const paramUserId = params && typeof params['userId'] === 'number' ? (params['userId'] as number) : undefined
      const userInfo = AppStorage.Get('userInfo') as UserInfo | undefined
      const storedUserId = (userInfo && typeof userInfo.id === 'number') ? userInfo.id : undefined
      const fallbackUserId = AppStorage.Get('userId') as number | undefined
      const username = (userInfo && userInfo.username) ? userInfo.username : (AppStorage.Get('currentUsername') as string | undefined)

      let userId: number | undefined = undefined
      if (typeof paramUserId === 'number') {
        userId = paramUserId
        console.info(`[MyMissingPets] ä½¿ç”¨è·¯ç”±å‚æ•° userId: ${userId}`)
      } else if (typeof storedUserId === 'number') {
        userId = storedUserId
        console.info(`[MyMissingPets] ä½¿ç”¨å­˜å‚¨çš„ç”¨æˆ·ID: ${userId}`)
      } else if (typeof fallbackUserId === 'number') {
        userId = fallbackUserId
        console.info(`[MyMissingPets] ä½¿ç”¨ AppStorage.userId: ${userId}`)
      } else if (username) {
        // åˆå§‹åŒ– UserService å¹¶é€šè¿‡ç”¨æˆ·åæŸ¥è¯¢ID
        await this.userService.init()
        const userIdStr = await this.userService.getUserIdByUsername(username)
        userId = userIdStr ? Number(userIdStr) : undefined
        console.info(`[MyMissingPets] é€šè¿‡ç”¨æˆ·åæŸ¥å¾—ç”¨æˆ·ID: ${userId}`)
      }

      if (typeof userId !== 'number' || isNaN(userId)) {
        this.errorMessage = 'æœªç™»å½•æˆ–æ— æ³•è¯†åˆ«ç”¨æˆ·ï¼Œè¯·å…ˆç™»å½•'
        this.allPosts = []
        this.posts = []
        prompt.showToast({ message: this.errorMessage, duration: 1500 })
        return
      }

      // è·å–å½“å‰ç”¨æˆ·çš„å¯»å® åˆ—è¡¨ï¼ˆä¸¥æ ¼æŒ‰ç”¨æˆ·æ˜¾ç¤ºï¼‰
      const missingPets = await this.apiService.getMissingPetsByUser(userId)
      this.allPosts = missingPets

      console.info(`æˆåŠŸåŠ è½½ ${this.allPosts.length} æ¡å¯»å® è®°å½•`)
      this.filterByTab(this.currentTab)
      
    } catch (error) {
      console.error(`åŠ è½½æˆ‘çš„å¯»å® å¤±è´¥: ${error}`)
      this.errorMessage = 'åŠ è½½æ•°æ®å¤±è´¥ï¼Œè¯·é‡è¯•'
      this.allPosts = []
      this.posts = []
    } finally {
      this.isLoading = false
    }
  }

  // æ ¹æ®æ ‡ç­¾ç­›é€‰æ•°æ®
  filterByTab(index: number): void {
    this.currentTab = index
    const label = this.tabs[index]
    
    if (label === STATUS_ALL) {
      this.posts = this.allPosts
    } else if (label === STATUS_ACTIVE) {
      this.posts = this.allPosts.filter(p => p.status === 'ACTIVE')
    } else if (label === STATUS_FOUND) {
      this.posts = this.allPosts.filter(p => p.status === 'FOUND')
    } else if (label === STATUS_CLOSED) {
      this.posts = this.allPosts.filter(p => p.status === 'CLOSED')
    }
  }

  // æ›´æ–°å¯»å® çŠ¶æ€
  async updateStatus(id: number, newStatus: MissingPetStatus): Promise<void> {
    try {
      const result = await this.apiService.updateMissingPetStatus(id, newStatus)
      if (result) {
        // æ›´æ–°æœ¬åœ°æ•°æ®
        this.allPosts = this.allPosts.map((p: MissingPet) => {
          if (p.id === id) {
            const updated: MissingPet = {
              id: p.id,
              userId: p.userId,
              title: p.title,
              petName: p.petName,
              type: p.type,
              gender: p.gender,
              age: p.age,
              lostTime: p.lostTime,
              city: p.city,
              lostAddress: p.lostAddress,
              description: p.description,
              contactName: p.contactName,
              contactPhone: p.contactPhone,
              status: newStatus,
              reward: p.reward,
              image: p.image,
              createdAt: p.createdAt,
              updatedAt: p.updatedAt,
              foundAt: p.foundAt
            }
            return updated
          }
          return p
        })
        this.filterByTab(this.currentTab)
        
        const statusText = newStatus === 'FOUND' ? 'å·²æ‰¾åˆ°' : newStatus === 'CLOSED' ? 'å·²å…³é—­' : 'å¯»æ‰¾ä¸­'
        prompt.showToast({ message: `çŠ¶æ€å·²æ›´æ–°ä¸ºï¼š${statusText}`, duration: 1500 })
      } else {
        prompt.showToast({ message: 'æ›´æ–°çŠ¶æ€å¤±è´¥ï¼Œè¯·é‡è¯•', duration: 1500 })
      }
    } catch (error) {
      console.error('æ›´æ–°çŠ¶æ€å¼‚å¸¸:', error)
      prompt.showToast({ message: 'æ›´æ–°çŠ¶æ€å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ', duration: 1500 })
    }
  }

  // è·å–çŠ¶æ€é¢œè‰²
  getStatusColor(status: MissingPetStatus): string {
    switch (status) {
      case 'ACTIVE':
        return '#FF9500' // æ©™è‰² - å¯»æ‰¾ä¸­
      case 'FOUND':
        return '#34C759' // ç»¿è‰² - å·²æ‰¾åˆ°  
      case 'CLOSED':
        return '#8E8E93' // ç°è‰² - å·²å…³é—­
      default:
        return '#8E8E93'
    }
  }

  // è·å–çŠ¶æ€æ–‡æœ¬
  getStatusText(status: MissingPetStatus): string {
    switch (status) {
      case 'ACTIVE':
        return 'å¯»æ‰¾ä¸­'
      case 'FOUND':
        return 'å·²æ‰¾åˆ°'
      case 'CLOSED':
        return 'å·²å…³é—­'
      default:
        return 'æœªçŸ¥'
    }
  }

  // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
  formatTime(timeStr?: string | null): string {
    if (!timeStr || typeof timeStr !== 'string') {
      return 'åˆšåˆšå‘å¸ƒ'
    }
    
    try {
      const normalized = timeStr.includes('T') ? timeStr : timeStr.replace(' ', 'T')
      const date = new Date(normalized)
      const now = new Date()
      const diffMs = now.getTime() - date.getTime()
      const diffHours = Math.floor(diffMs / (1000 * 60 * 60))
      const diffDays = Math.floor(diffHours / 24)
      
      if (diffHours < 1) {
        return 'åˆšåˆšå‘å¸ƒ'
      } else if (diffHours < 24) {
        return `${diffHours}å°æ—¶å‰å‘å¸ƒ`
      } else {
        return `${diffDays}å¤©å‰å‘å¸ƒ`
      }
    } catch (error) {
      console.error('æ—¶é—´æ ¼å¼åŒ–å¤±è´¥:', error)
      return timeStr || 'æœªçŸ¥æ—¶é—´'
    }
  }

  // æ ¼å¼åŒ–èµ°å¤±æ—¶é—´
  formatLostTime(timeStr?: string | null): string {
    if (!timeStr || typeof timeStr !== 'string') {
      return 'æœªçŸ¥'
    }
    
    try {
      const date = new Date(timeStr)
      const year = date.getFullYear()
      const month = String(date.getMonth() + 1).padStart(2, '0')
      const day = String(date.getDate()).padStart(2, '0')
      const hour = String(date.getHours()).padStart(2, '0')
      const minute = String(date.getMinutes()).padStart(2, '0')
      
      return `${year}-${month}-${day} ${hour}:${minute}`
    } catch (e) {
      return timeStr
    }
  }

  // é¡¶éƒ¨å¯¼èˆªæ 
  @Builder TopBar(): void {
    Row() {
      // å·¦ä¾§è¿”å›ï¼Œå›ºå®šå®½åº¦å®¹å™¨ï¼Œä¿è¯ä¸­é—´æ ‡é¢˜ç»å¯¹å±…ä¸­
      Row() {
        Button() {
          Image($r('app.media.arrow_left'))
            .width(24)
            .height(24)
            .fillColor('#1C1C1E')
        }
        .type(ButtonType.Normal)
        .backgroundColor(Color.Transparent)
        .onClick(() => router.back())
      }
      .width(64)
      .height(32)
      .alignItems(VerticalAlign.Center)

      // ä¸­é—´æ ‡é¢˜
      Text('æˆ‘çš„å¯»å® ')
        .fontSize(18)
        .fontWeight(FontWeight.Bold)
        .fontColor('#1C1C1E')
        .layoutWeight(1)
        .textAlign(TextAlign.Center)

      // å³ä¾§å‘å¸ƒæŒ‰é’®ï¼Œä½¿ç”¨ä¸å·¦ä¾§ç›¸åŒå®½åº¦å®¹å™¨ï¼Œä¿æŒå¯¹ç§°
      Row() {
        Button() {
          Text('å‘å¸ƒ')
            .fontSize(14)
            .fontColor(Color.White)
        }
        .type(ButtonType.Normal)
        .height(32)
        .backgroundColor('#FF9500')
        .padding({ left: 12, right: 12, top: 0, bottom: 0 })
        .borderRadius(16)
        .onClick(() => {
          router.pushUrl({
            url: 'pages/Profile/EditMissingPet',
            params: { mode: 'create' }
          })
        })
      }
      .width(64)
      .height(32)
      .justifyContent(FlexAlign.End)
      .alignItems(VerticalAlign.Center)
    }
    .width('100%')
    .height(56)
    .backgroundColor(Color.White)
    .padding({ left: 16, right: 16, top: 8 })
    .border({ width: { bottom: 0.5 }, color: '#E5E5EA' })
  }

  // ç­›é€‰æ ‡ç­¾æ 
  @Builder TabsBar(): void {
    Tabs() {
      ForEach(this.tabs, (tab: string, index: number) => {
        TabContent() {
          this.ContentBuilder()
        }
        .tabBar(tab)
      })
    }
    .onChange((index: number) => this.filterByTab(index))
    .barMode(BarMode.Fixed)
    .barHeight(44)
    .width('100%')
    .layoutWeight(1)
  }

  // å¯»å® å¡ç‰‡
  @Builder MissingPetCard(pet: MissingPet): void {
    Column() {
      // é¡¶éƒ¨çŠ¶æ€æ¡
      Row() {
        // ç¼–å·æ˜¾ç¤º
        Text(`ç¼–å·: ${String(pet.id).padStart(6, '0')}`)
          .fontSize(12)
          .fontColor('#8E8E93')
          .backgroundColor('#F2F2F7')
          .padding({ left: 8, right: 8, top: 4, bottom: 4 })
          .borderRadius(8)

        Blank()

        // çŠ¶æ€æ ‡ç­¾
        Text(this.getStatusText(pet.status))
          .fontSize(12)
          .fontColor(Color.White)
          .backgroundColor(this.getStatusColor(pet.status))
          .padding({ left: 10, right: 10, top: 5, bottom: 5 })
          .borderRadius(12)
      }
      .width('100%')
      .margin({ bottom: 12 })

      // å® ç‰©ä¿¡æ¯è¡Œ
      Row() {
        // å® ç‰©å›¾ç‰‡
        Image($r(pet.image || 'app.media.person'))
          .width(88)
          .height(88)
          .borderRadius(16)
          .objectFit(ImageFit.Cover)
          .backgroundColor('#F2F2F7')
          .border({ width: 1, color: '#E5E5EA' })

        // å® ç‰©è¯¦æƒ…
        Column() {
          // æ ‡é¢˜å’Œå® ç‰©å
          Text(pet.title)
            .fontSize(16)
            .fontWeight(FontWeight.Bold)
            .fontColor('#1C1C1E')
            .maxLines(1)
            .textOverflow({ overflow: TextOverflow.Ellipsis })
            .width('100%')
            .margin({ bottom: 6 })

          // å® ç‰©åŸºæœ¬ä¿¡æ¯
          Row() {
            Text(pet.petName)
              .fontSize(14)
              .fontColor('#1C1C1E')
              .fontWeight(FontWeight.Medium)
            Image($r(pet.gender ? 'app.media.Animalgender' : 'app.media.Animalgenderf'))
              .width(16)
              .height(16)
              .margin({ left: 6 })
            Text(`${pet.age}å²`)
              .fontSize(14)
              .fontColor('#8E8E93')
              .margin({ left: 8 })
            Text('Â·')
              .fontSize(14)
              .fontColor('#8E8E93')
              .margin({ left: 4, right: 4 })
            Text(pet.type)
              .fontSize(14)
              .fontColor('#8E8E93')
          }
          .margin({ bottom: 6 })

          // èµ°å¤±ä¿¡æ¯
          Row() {
            Image($r('app.media.local_fill2'))
              .width(14)
              .height(14)
              .margin({ right: 4 })
            Text(pet.city + ' ' + pet.lostAddress)
              .fontSize(13)
              .fontColor('#8E8E93')
              .maxLines(1)
              .textOverflow({ overflow: TextOverflow.Ellipsis })
              .layoutWeight(1)
          }
          .width('100%')
          .margin({ bottom: 6 })

          // æ‚¬èµé‡‘é¢
          if (pet.reward && pet.reward > 0) {
            Row() {
              Text(`æ‚¬èµ Â¥${pet.reward}`)
                .fontSize(14)
                .fontColor('#FF6B35')
                .fontWeight(FontWeight.Bold)
                .backgroundColor('#FFF3E0')
                .padding({ left: 8, right: 8, top: 2, bottom: 2 })
                .borderRadius(4)
            }
          }
        }
        .layoutWeight(1)
        .margin({ left: 16 })
        .alignItems(HorizontalAlign.Start)
      }
      .width('100%')
      .alignItems(VerticalAlign.Top)

      // åˆ†å‰²çº¿
      Divider()
        .margin({ top: 12, bottom: 12 })
        .color('#E5E5EA')

      // æ—¶é—´ä¿¡æ¯
      Row() {
        Column() {
          Text(`èµ°å¤±æ—¶é—´ï¼š${this.formatLostTime(pet.lostTime)}`)
            .fontSize(12)
            .fontColor('#8E8E93')
            .margin({ bottom: 4 })
          Text(`å‘å¸ƒæ—¶é—´ï¼š${this.formatTime(pet.createdAt)}`)
            .fontSize(12)
            .fontColor('#8E8E93')
        }
        .alignItems(HorizontalAlign.Start)
        .layoutWeight(1)

        // è”ç³»ä¿¡æ¯
        Text(`${pet.contactName} ${pet.contactPhone}`)
          .fontSize(12)
          .fontColor('#8E8E93')
      }
      .width('100%')
      .margin({ bottom: 12 })

      // æ“ä½œæŒ‰é’®
      Row() {
        // è¯¦æƒ…æŒ‰é’®
        Button('è¯¦æƒ…')
          .fontSize(14)
          .fontWeight(FontWeight.Medium)
          .backgroundColor('#E6F0FF')
          .fontColor('#007AFF')
          .border({ width: 1, color: '#B3D7FF' })
          .height(32)
          .padding({ left: 10, right: 10, top: 0, bottom: 0 })
          .borderRadius(16)
          .onClick(() => {
            router.pushUrl({
              url: 'pages/Home/MissingPetDetail',
              params: { id: pet.id }
            })
          })

        // ç¼–è¾‘æŒ‰é’®
        if (pet.status === 'ACTIVE') {
            Button('ç¼–è¾‘')
              .fontSize(14)
              .fontWeight(FontWeight.Medium)
              .backgroundColor('#E6F0FF')
              .fontColor('#007AFF')
              .border({ width: 1, color: '#B3D7FF' })
              .height(32)
              .padding({ left: 16, right: 16, top: 0, bottom: 0 })
              .borderRadius(16)
              .margin({ left: 8 })
              .onClick(() => {
                router.pushUrl({
                  url: 'pages/Profile/EditMissingPet',
                  params: { id: pet.id, mode: 'edit' }
                })
              })
        }

        Blank()

        // çŠ¶æ€æ›´æ–°æŒ‰é’®
        if (pet.status === 'ACTIVE') {
          Row() {
            Button('æ ‡è®°å·²æ‰¾åˆ°')
              .fontSize(14)
              .fontColor('#212529')
              .backgroundColor('#ffe7e7e7')
              .border({ width: 1, color: '#34C75930' })
              .height(32)
              .padding({ left: 16, right: 16, top: 0, bottom: 0 })
              .borderRadius(16)
              .onClick(() => this.updateStatus(pet.id, 'FOUND'))

            Button('å…³é—­')
              .fontSize(14)
              .fontColor(Color.White)
              .backgroundColor('#dc3545')
              .border({ width: 1, color: '#8E8E9330' })
              .height(32)
              .padding({ left: 16, right: 16, top: 0, bottom: 0 })
              .borderRadius(16)
              .margin({ left: 5 })
              .onClick(() => this.updateStatus(pet.id, 'CLOSED'))
          }
          .margin({ left:5 })
        } else if (pet.status === 'FOUND') {
          Button('é‡æ–°å‘å¸ƒ')
            .fontSize(14)
            .fontColor('#FF9500')
            .backgroundColor('#FF950015')
            .border({ width: 1, color: '#FF950030' })
            .height(32)
            .padding({ left: 16, right: 16, top: 0, bottom: 0 })
            .borderRadius(16)
            .onClick(() => this.updateStatus(pet.id, 'ACTIVE'))
        } else if (pet.status === 'CLOSED') {
          Button('é‡æ–°å‘å¸ƒ')
            .fontSize(14)
            .fontColor('#FF9500')
            .backgroundColor('#FF950015')
            .border({ width: 1, color: '#FF950030' })
            .height(32)
            .padding({ left: 16, right: 16, top: 0, bottom: 0 })
            .borderRadius(16)
            .onClick(() => this.updateStatus(pet.id, 'ACTIVE'))
        }
      }
      .width('100%')
    }
    .width('100%')
    .backgroundColor(Color.White)
    .borderRadius(18)
    .padding(20)
    .margin({ bottom: 16 })
    .shadow({ radius: 8, color: '#00000008', offsetY: 4 })
  }

  // å†…å®¹æ„å»ºå™¨
  @Builder ContentBuilder(): void {
    if (this.isLoading) {
      // åŠ è½½çŠ¶æ€
      Column() {
        LoadingProgress()
          .width(40)
          .height(40)
          .color('#007AFF')
        
        Text('åŠ è½½ä¸­...')
          .fontSize(14)
          .fontColor('#8E8E93')
          .margin({ top: 12 })
      }
      .width('100%')
      .height('100%')
      .justifyContent(FlexAlign.Center)
    } else if (this.errorMessage) {
      // é”™è¯¯çŠ¶æ€
      Column() {
        Text('ğŸ˜•')
          .fontSize(60)
          .margin({ top: 60 })
        
        Text(this.errorMessage)
          .fontSize(16)
          .fontColor('#FF3B30')
          .fontWeight(FontWeight.Medium)
          .margin({ top: 20 })
        
        Button('é‡æ–°åŠ è½½')
          .fontSize(15)
          .fontColor('#007AFF')
          .backgroundColor('#007AFF15')
          .borderRadius(24)
          .height(48)
          .width(160)
          .margin({ top: 32 })
          .onClick(() => {
            this.loadMyMissingPets()
          })
      }
      .width('100%')
      .height('100%')
      .justifyContent(FlexAlign.Center)
    } else {
      // æ­£å¸¸å†…å®¹
      List() {
        if (this.posts.length === 0) {
          // ç©ºçŠ¶æ€
          ListItem() {
            Column() {
              Text(this.currentTab === 2 ? 'ğŸ‰' : this.currentTab === 3 ? 'ğŸ“¦' : 'ğŸ”')
                .fontSize(60)
                .margin({ top: 60 })
              
              Text(
                this.currentTab === 2 ? 'æš‚æ— å·²æ‰¾åˆ°çš„å® ç‰©' :
                  this.currentTab === 3 ? 'æš‚æ— å·²å…³é—­çš„å¯»å® ' :
                    this.currentTab === 1 ? 'æš‚æ— æ­£åœ¨å¯»æ‰¾çš„å® ç‰©' :
                      'æš‚æ— å¯»å® å‘å¸ƒ'
              )
                .fontSize(18)
                .fontColor('#8E8E93')
                .fontWeight(FontWeight.Medium)
                .margin({ top: 20 })
              
              Text(
                this.currentTab === 2 ? 'æ‰¾åˆ°èµ°å¤±çš„å® ç‰©åè®°å½•ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ' :
                  this.currentTab === 3 ? 'å…³é—­çš„å¯»å® è®°å½•ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ' :
                    'å‘å¸ƒå¯»å® ä¿¡æ¯ï¼Œè®©æ›´å¤šäººå¸®æ‚¨å¯»æ‰¾èµ°å¤±çš„çˆ±å® '
              )
                .fontSize(14)
                .fontColor('#C7C7CC')
                .textAlign(TextAlign.Center)
                .lineHeight(20)
                .margin({ top: 12, left: 32, right: 32 })
              
              if (this.currentTab === 0 || this.currentTab === 1) {
                Button('å»å‘å¸ƒ')
                  .fontSize(15)
                  .fontColor('#007AFF')
                  .backgroundColor('#007AFF15')
                  .borderRadius(24)
                  .height(48)
                  .width(160)
                  .margin({ top: 32 })
                  .onClick(() => {
                    router.pushUrl({
                      url: 'pages/Profile/EditMissingPet',
                      params: { mode: 'create' }
                    })
                  })
              }
            }
            .width('100%')
            .height(500)
            .justifyContent(FlexAlign.Center)
          }
        } else {
          // æ•°æ®åˆ—è¡¨
          ForEach(
            this.posts,
            (pet: MissingPet) => {
              ListItem() {
                this.MissingPetCard(pet)
              }
            },
            (pet: MissingPet) => `${pet.id}-${pet.status}`
          )
        }
      }
      .width('100%')
      .height('100%')
      .padding({ left: 16, right: 16, top: 16, bottom: 16 })
      .scrollBar(BarState.Off)
      .edgeEffect(EdgeEffect.Spring)
    }
  }

  build() {
    Column() {
      this.TopBar()
      this.TabsBar()
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F2F2F7')
  }
}
