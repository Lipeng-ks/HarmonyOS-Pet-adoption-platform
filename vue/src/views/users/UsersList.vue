<template>
  <div class="users-page">
    <!-- È°µÈù¢Ê†áÈ¢ò -->
    <div class="page-header">
      <div class="header-content">
        <h1>Áî®Êà∑ÁÆ°ÁêÜ</h1>
        <p>ÁÆ°ÁêÜÁ≥ªÁªüÁî®Êà∑‰ø°ÊÅØÂíåÂú∞ÂùÄ</p>
      </div>
    </div>

    <!-- Êìç‰ΩúÂå∫Âüü -->
    <el-card class="action-card" shadow="never">
      <div class="action-bar">
        <div class="search-area">
          <el-input 
            v-model="queryUsername" 
            placeholder="ËæìÂÖ•Áî®Êà∑ÂêçÊü•ËØ¢" 
            clearable 
            style="width: 240px" 
            @keyup.enter="onSearch"
          >
            <template #append>
              <el-button @click="onSearch" :loading="loading">
                <el-icon><Search /></el-icon>
              </el-button>
            </template>
          </el-input>
        </div>
        <div class="button-group">
          <el-button type="primary" @click="openCreate">
            <el-icon><Plus /></el-icon>
            Êñ∞Â¢ûÁî®Êà∑
          </el-button>
          <el-button @click="fetchAll" :loading="loading">
            <el-icon><Refresh /></el-icon>
            Âà∑Êñ∞ÂÖ®ÈÉ®
          </el-button>
        </div>
      </div>
    </el-card>

    <!-- Êï∞ÊçÆË°®Ê†º -->
    <el-card class="table-card" shadow="never">
      <el-table :data="tableData" v-loading="loading" stripe>
        <el-table-column prop="username" label="Áî®Êà∑Âêç" min-width="120" />
        <el-table-column prop="email" label="ÈÇÆÁÆ±" min-width="160" />
        <el-table-column prop="phone" label="ÁîµËØù" width="120" />
        <el-table-column prop="address" label="Âú∞ÂùÄ" min-width="160" show-overflow-tooltip />
        <el-table-column label="Êìç‰Ωú" width="240" fixed="right">
          <template #default="{ row }">
            <div class="action-buttons">
              <el-button size="small" @click="openEdit(row)">
                <el-icon><Edit /></el-icon>
                ÁºñËæë
              </el-button>
              <el-button size="small" type="primary" @click="openAddressManager(row)">
                <el-icon><Location /></el-icon>
                Âú∞ÂùÄÁÆ°ÁêÜ
              </el-button>
              <el-popconfirm title="Á°ÆËÆ§Âà†Èô§ËØ•Áî®Êà∑Ôºü" @confirm="onDelete(row)">
                <template #reference>
                  <el-button size="small" type="danger">
                    <el-icon><Delete /></el-icon>
                    Âà†Èô§
                  </el-button>
                </template>
              </el-popconfirm>
            </div>
          </template>
        </el-table-column>
      </el-table>

      <el-empty v-if="!loading && tableData.length === 0" description="ÊöÇÊó†Áî®Êà∑Êï∞ÊçÆ" />
    </el-card>

    <!-- Êñ∞Â¢û/ÁºñËæëÁî®Êà∑ÂºπÁ™ó -->
    <el-dialog v-model="dialog.visible" :title="dialog.isEdit ? 'ÁºñËæëÁî®Êà∑' : 'Êñ∞Â¢ûÁî®Êà∑'" width="500px">
      <el-form :model="dialog.form" label-width="80px" label-position="top">
        <el-row :gutter="16">
          <el-col :span="12">
            <el-form-item label="Áî®Êà∑Âêç">
              <el-input 
                v-model="dialog.form.username" 
                :disabled="dialog.isEdit" 
                placeholder="ËØ∑ËæìÂÖ•Áî®Êà∑Âêç"
              />
            </el-form-item>
          </el-col>
          <el-col :span="12" v-if="!dialog.isEdit">
            <el-form-item label="ÂØÜÁ†Å">
              <el-input 
                v-model="dialog.form.password" 
                type="password" 
                placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å"
                show-password
              />
            </el-form-item>
          </el-col>
        </el-row>
        
        <el-row :gutter="16">
          <el-col :span="12">
            <el-form-item label="ÈÇÆÁÆ±">
              <el-input v-model="dialog.form.email" placeholder="ËØ∑ËæìÂÖ•ÈÇÆÁÆ±" />
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="ÁîµËØù">
              <el-input v-model="dialog.form.phone" placeholder="ËØ∑ËæìÂÖ•ÁîµËØù" />
            </el-form-item>
          </el-col>
        </el-row>
        
        <el-form-item label="Âú∞ÂùÄ">
          <el-input v-model="dialog.form.address" placeholder="ËØ∑ËæìÂÖ•Âú∞ÂùÄ" />
        </el-form-item>
      </el-form>
      
      <template #footer>
        <div class="dialog-footer">
          <el-button @click="dialog.visible = false">ÂèñÊ∂à</el-button>
          <el-button type="primary" :loading="submitting" @click="onSubmit">
            {{ dialog.isEdit ? 'Êõ¥Êñ∞' : 'ÂàõÂª∫' }}
          </el-button>
        </div>
      </template>
    </el-dialog>

    <!-- Âú∞ÂùÄÁÆ°ÁêÜÂºπÁ™ó -->
    <el-dialog 
      v-model="addrDlg.visible" 
      :title="`Âú∞ÂùÄÁÆ°ÁêÜ - ${addrDlg.username}`" 
      width="900px"
      :close-on-click-modal="false"
      class="address-dialog"
    >
      <div class="address-manager">
        <!-- È°∂ÈÉ®Êìç‰ΩúÊ†è -->
        <div class="manager-header">
          <div class="header-info">
            <h3>üìç Âú∞ÂùÄÂàóË°®</h3>
            <p>ÁÆ°ÁêÜÁî®Êà∑ÁöÑÊî∂Ë¥ßÂú∞ÂùÄ‰ø°ÊÅØ</p>
          </div>
          <el-button type="primary" @click="startAddNew" :disabled="addrDlg.showForm">
            <el-icon><Plus /></el-icon>
            Êñ∞Â¢ûÂú∞ÂùÄ
          </el-button>
        </div>

        <!-- Âú∞ÂùÄÂàóË°® -->
        <div class="address-list-section">
          <el-table 
            :data="addrDlg.list" 
            v-loading="addrDlg.loading" 
            class="address-table"
            empty-text="ÊöÇÊó†Âú∞ÂùÄ‰ø°ÊÅØ"
          >
            <el-table-column type="index" label="#" width="50" align="center" />
            <el-table-column prop="name" label="Êî∂‰ª∂‰∫∫" width="100" />
            <el-table-column prop="phone" label="ËÅîÁ≥ªÁîµËØù" width="130" />
            <el-table-column label="Âú∞Âå∫" width="150">
              <template #default="{ row }">
                <span class="location-text">{{ row.city }}</span>
              </template>
            </el-table-column>
            <el-table-column prop="detail" label="ËØ¶ÁªÜÂú∞ÂùÄ" min-width="200" show-overflow-tooltip />
            <el-table-column label="ÈªòËÆ§Âú∞ÂùÄ" width="90" align="center">
              <template #default="{ row }">
                <el-tag v-if="row.isDefault" type="success" size="small">ÈªòËÆ§</el-tag>
                <span v-else class="text-muted">-</span>
              </template>
            </el-table-column>
            <el-table-column label="Êìç‰Ωú" width="140" align="center">
              <template #default="{ row }">
                <div class="table-actions">
                  <el-button size="small" @click="editAddress(row)" :disabled="addrDlg.showForm">
                    ÁºñËæë
                  </el-button>
                  <el-popconfirm title="Á°ÆËÆ§Âà†Èô§ËØ•Âú∞ÂùÄÔºü" @confirm="removeAddress(row)">
                    <template #reference>
                      <el-button size="small" type="danger" :disabled="addrDlg.showForm">
                        Âà†Èô§
                      </el-button>
                    </template>
                  </el-popconfirm>
                </div>
              </template>
            </el-table-column>
          </el-table>
          
          <el-empty 
            v-if="!addrDlg.loading && addrDlg.list.length === 0" 
            description="ÊöÇÊó†Âú∞ÂùÄ‰ø°ÊÅØ"
            :image-size="100"
          />
        </div>

        <!-- Âú∞ÂùÄË°®Âçï -->
        <div v-if="addrDlg.showForm" class="address-form-section">
          <div class="form-header">
            <h4>{{ addrDlg.isEdit ? '‚úèÔ∏è ÁºñËæëÂú∞ÂùÄ' : '‚ûï Êñ∞Â¢ûÂú∞ÂùÄ' }}</h4>
          </div>
          
          <el-form 
            :model="addrDlg.form" 
            :rules="addressRules" 
            ref="addressFormRef"
            label-width="100px"
            class="address-form"
          >
            <el-row :gutter="20">
              <el-col :span="12">
                <el-form-item label="Êî∂‰ª∂‰∫∫" prop="name">
                  <el-input 
                    v-model="addrDlg.form.name" 
                    placeholder="ËØ∑ËæìÂÖ•Êî∂‰ª∂‰∫∫ÂßìÂêç"
                    maxlength="50"
                    show-word-limit
                  />
                </el-form-item>
              </el-col>
              <el-col :span="12">
                <el-form-item label="ËÅîÁ≥ªÁîµËØù" prop="phone">
                  <el-input 
                    v-model="addrDlg.form.phone" 
                    placeholder="ËØ∑ËæìÂÖ•11‰ΩçÊâãÊú∫Âè∑Á†Å"
                    maxlength="11"
                  />
                </el-form-item>
              </el-col>
            </el-row>
            
            <el-row :gutter="20">
              <el-col :span="12">
                <el-form-item label="ÁúÅ‰ªΩ">
                  <el-select 
                    v-model="addrProvince" 
                    placeholder="ËØ∑ÈÄâÊã©ÁúÅ‰ªΩ" 
                    style="width: 100%" 
                    @change="onAddrProvinceChange"
                    clearable
                    filterable
                  >
                    <el-option v-for="p in provinces" :key="p" :value="p" :label="p" />
                  </el-select>
                </el-form-item>
              </el-col>
              <el-col :span="12">
                <el-form-item label="ÂüéÂ∏Ç" prop="city">
                  <el-select 
                    v-model="addrDlg.form.city" 
                    placeholder="ËØ∑ÈÄâÊã©ÂüéÂ∏Ç" 
                    style="width: 100%"
                    :disabled="!addrProvince"
                    clearable
                    filterable
                  >
                    <el-option v-for="c in cities" :key="c" :value="c" :label="c" />
                  </el-select>
                </el-form-item>
              </el-col>
            </el-row>
            
            <el-form-item label="ËØ¶ÁªÜÂú∞ÂùÄ" prop="detail">
              <el-input 
                v-model="addrDlg.form.detail" 
                type="textarea" 
                :rows="3"
                placeholder="ËØ∑ËæìÂÖ•ËØ¶ÁªÜÂú∞ÂùÄÔºåÂ¶ÇË°óÈÅì„ÄÅÈó®ÁâåÂè∑„ÄÅÊ•ºÊ†ãÂçïÂÖÉÁ≠â"
                maxlength="200"
                show-word-limit
              />
            </el-form-item>
            
            <el-form-item label="ÈªòËÆ§Âú∞ÂùÄ">
              <div class="default-switch">
                <el-switch 
                  v-model="addrDlg.form.isDefault" 
                  active-text="ËÆæ‰∏∫ÈªòËÆ§" 
                  inactive-text="ÊôÆÈÄöÂú∞ÂùÄ"
                  :active-value="true"
                  :inactive-value="false"
                />
                <span class="switch-tip">ËÆæ‰∏∫ÈªòËÆ§Âú∞ÂùÄÂêéÔºåÂÖ∂‰ªñÂú∞ÂùÄÁöÑÈªòËÆ§Áä∂ÊÄÅÂ∞ÜË¢´ÂèñÊ∂à</span>
              </div>
            </el-form-item>
            
            <el-form-item class="form-actions">
              <div class="action-buttons">
                <el-button @click="cancelAddressEdit" size="default">
                  ÂèñÊ∂à
                </el-button>
                <el-button 
                  type="primary" 
                  :loading="addrDlg.saving" 
                  @click="submitAddress"
                  size="default"
                >
                  {{ addrDlg.isEdit ? 'Êõ¥Êñ∞Âú∞ÂùÄ' : '‰øùÂ≠òÂú∞ÂùÄ' }}
                </el-button>
              </div>
            </el-form-item>
          </el-form>
        </div>
      </div>
      
      <template #footer>
        <div class="dialog-footer">
          <el-button @click="closeAddressManager" size="default">ÂÖ≥Èó≠</el-button>
        </div>
      </template>
    </el-dialog>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, onMounted } from 'vue'
import { ElMessage } from 'element-plus'
import { 
  Search, 
  Plus, 
  Refresh, 
  Edit, 
  Location, 
  Delete 
} from '@element-plus/icons-vue'
import { getUser, listAllUsers, createUser, updateUser, deleteUser, type UserInfo } from '@/services/users'
import { listUserAddresses, addUserAddress, updateUserAddress, deleteUserAddress, type UserAddress } from '@/services/addresses'
import { listProvinces, listCitiesByProvince } from '@/services/provinces'

const loading = ref(false)
const queryUsername = ref('')
const tableData = ref<UserInfo[]>([])

const dialog = reactive<{ visible: boolean; isEdit: boolean; form: UserInfo }>({
  visible: false,
  isEdit: false,
  form: { username: '', password: '' }
})
const submitting = ref(false)

// Âú∞ÂùÄÁÆ°ÁêÜÂØπËØùÊ°ÜÁä∂ÊÄÅ
const addrDlg = reactive<{
  visible: boolean
  username: string
  list: UserAddress[]
  loading: boolean
  showForm: boolean
  isEdit: boolean
  editingId?: number | null
  form: UserAddress
  saving: boolean
}>({
  visible: false,
  username: '',
  list: [],
  loading: false,
  showForm: false,
  isEdit: false,
  editingId: null,
  form: { name: '', phone: '', city: '', detail: '', isDefault: false },
  saving: false
})

// Âú∞ÂùÄË°®ÂçïÂºïÁî®ÂíåÈ™åËØÅËßÑÂàô
const addressFormRef = ref()
const addressRules = {
  name: [
    { required: true, message: 'ËØ∑ËæìÂÖ•Êî∂‰ª∂‰∫∫ÂßìÂêç', trigger: 'blur' },
    { min: 2, max: 50, message: 'ÂßìÂêçÈïøÂ∫¶Âú®2Âà∞50‰∏™Â≠óÁ¨¶', trigger: 'blur' }
  ],
  phone: [
    { required: true, message: 'ËØ∑ËæìÂÖ•ËÅîÁ≥ªÁîµËØù', trigger: 'blur' },
    { pattern: /^1[3-9]\d{9}$/, message: 'ËØ∑ËæìÂÖ•Ê≠£Á°ÆÁöÑÊâãÊú∫Âè∑Á†Å', trigger: 'blur' }
  ],
  city: [
    { required: true, message: 'ËØ∑ÈÄâÊã©ÂüéÂ∏Ç', trigger: 'change' }
  ],
  detail: [
    { required: true, message: 'ËØ∑ËæìÂÖ•ËØ¶ÁªÜÂú∞ÂùÄ', trigger: 'blur' },
    { min: 5, max: 200, message: 'ËØ¶ÁªÜÂú∞ÂùÄÈïøÂ∫¶Âú®5Âà∞200‰∏™Â≠óÁ¨¶', trigger: 'blur' }
  ]
}

// ÁúÅÂ∏ÇËÅîÂä®ÔºàÂú∞ÂùÄÁÆ°ÁêÜÔºâ
const provinces = ref<string[]>([])
const cities = ref<string[]>([])
const addrProvince = ref<string>('')
const citiesCache = reactive<Record<string, string[]>>({})

async function fetchAll() {
  loading.value = true
  try {
    const res = await listAllUsers()
    tableData.value = res.data || []
  } catch (e: any) {
    ElMessage.error(e.message || 'Âä†ËΩΩÂÖ®ÈÉ®Áî®Êà∑Â§±Ë¥•')
  } finally {
    loading.value = false
  }
}

async function onSearch() {
  if (!queryUsername.value) {
    fetchAll()
    return
  }
  loading.value = true
  try {
    const res = await getUser(queryUsername.value)
    if (res.data) {
      tableData.value = [res.data]
    } else {
      tableData.value = []
    }
  } catch (e: any) {
    ElMessage.error(e.message || 'Êü•ËØ¢Â§±Ë¥•')
  } finally {
    loading.value = false
  }
}

function openCreate() {
  dialog.isEdit = false
  dialog.form = { username: '', password: '' }
  dialog.visible = true
}

function openEdit(row: UserInfo) {
  dialog.isEdit = true
  dialog.form = { ...row }
  dialog.visible = true
}

async function onSubmit() {
  submitting.value = true
  try {
    if (dialog.isEdit) {
      const res = await updateUser(dialog.form.username, dialog.form)
      if (res.success) ElMessage.success('Êõ¥Êñ∞ÊàêÂäü')
    } else {
      const res = await createUser(dialog.form)
      if (res.affectedRows === 1 || res.success) ElMessage.success('ÂàõÂª∫ÊàêÂäü')
    }
    dialog.visible = false
    onSearch()
  } catch (e: any) {
    ElMessage.error(e.message || '‰øùÂ≠òÂ§±Ë¥•')
  } finally {
    submitting.value = false
  }
}

async function onDelete(row: UserInfo) {
  try {
    const res = await deleteUser(row.username)
    if (res.success || res.affectedRows === 1) {
      ElMessage.success('Âà†Èô§ÊàêÂäü')
      onSearch()
    }
  } catch (e: any) {
    ElMessage.error(e.message || 'Âà†Èô§Â§±Ë¥•')
  }
}

// Âú∞ÂùÄÁÆ°ÁêÜ
async function openAddressManager(row: UserInfo) {
  if (!row.username) return
  addrDlg.username = row.username
  addrDlg.visible = true
  // ÂàùÂßãÂåñÁúÅÂàóË°®
  if (!provinces.value.length) {
    try {
      const res = await listProvinces()
      provinces.value = (res as any).data || res || []
    } catch {
      // ÂøΩÁï•ÈîôËØØ
    }
  }
  await loadAddresses()
}

async function loadAddresses() {
  if (!addrDlg.username) return
  addrDlg.loading = true
  try {
    const res = await listUserAddresses(addrDlg.username)
    addrDlg.list = (res.data as UserAddress[]) || []
  } catch (e: any) {
    ElMessage.error(e.message || 'Âä†ËΩΩÂú∞ÂùÄÂ§±Ë¥•')
  } finally {
    addrDlg.loading = false
  }
}

// ÂºÄÂßãÊñ∞Â¢ûÂú∞ÂùÄ
function startAddNew() {
  addrDlg.showForm = true
  addrDlg.isEdit = false
  addrDlg.editingId = null
  addrDlg.form = { name: '', phone: '', city: '', detail: '', isDefault: false }
  addrProvince.value = ''
  cities.value = []
  if (addressFormRef.value) {
    addressFormRef.value.clearValidate()
  }
}

function editAddress(row: UserAddress) {
  addrDlg.showForm = true
  addrDlg.isEdit = true
  addrDlg.editingId = row.id || null
  addrDlg.form = { ...row }
  // Ê†πÊçÆÂ∑≤ÊúâÂüéÂ∏ÇÂõûÂ°´ÁúÅ‰ªΩÂπ∂Âä†ËΩΩÂüéÂ∏Ç
  if (addrDlg.form.city) {
    inferProvinceByCity(addrDlg.form.city)
  }
  if (addressFormRef.value) {
    addressFormRef.value.clearValidate()
  }
}

// ÂèñÊ∂àÁºñËæë
function cancelAddressEdit() {
  addrDlg.showForm = false
  addrDlg.isEdit = false
  addrDlg.editingId = null
  addrDlg.form = { name: '', phone: '', city: '', detail: '', isDefault: false }
  addrProvince.value = ''
  cities.value = []
}

// ÂÖ≥Èó≠Âú∞ÂùÄÁÆ°ÁêÜÂô®
function closeAddressManager() {
  addrDlg.visible = false
  cancelAddressEdit()
}

async function submitAddress() {
  if (!addrDlg.username) return
  
  // Ë°®ÂçïÈ™åËØÅ
  if (addressFormRef.value) {
    try {
      await addressFormRef.value.validate()
    } catch {
      return
    }
  }
  
  addrDlg.saving = true
  try {
    if (addrDlg.isEdit && addrDlg.editingId) {
      const res = await updateUserAddress(addrDlg.username, addrDlg.editingId, addrDlg.form)
      if ((res as any).success !== false) {
        ElMessage.success('Âú∞ÂùÄÊõ¥Êñ∞ÊàêÂäü')
      }
    } else {
      const res = await addUserAddress(addrDlg.username, addrDlg.form)
      if ((res as any).success !== false) {
        ElMessage.success('Âú∞ÂùÄÊñ∞Â¢ûÊàêÂäü')
      }
    }
    
    cancelAddressEdit()
    await loadAddresses()
  } catch (e: any) {
    ElMessage.error(e.message || '‰øùÂ≠òÂú∞ÂùÄÂ§±Ë¥•')
  } finally {
    addrDlg.saving = false
  }
}

async function removeAddress(row: UserAddress) {
  if (!addrDlg.username || !row.id) return
  try {
    const res = await deleteUserAddress(addrDlg.username, row.id)
    if ((res as any).success !== false) {
      ElMessage.success('Âà†Èô§ÊàêÂäü')
      await loadAddresses()
    }
  } catch (e: any) {
    ElMessage.error(e.message || 'Âà†Èô§Â§±Ë¥•')
  }
}

async function onAddrProvinceChange() {
  try {
    cities.value = []
    if (!addrProvince.value) return
    if (citiesCache[addrProvince.value]) {
      cities.value = citiesCache[addrProvince.value]
      return
    }
    const res = await listCitiesByProvince(addrProvince.value)
    const list = (res as any).data || res || []
    citiesCache[addrProvince.value] = list
    cities.value = list
  } catch {
    // ÂøΩÁï•ÈîôËØØ
  }
}

async function inferProvinceByCity(city: string) {
  if (!city) return
  for (const p of provinces.value) {
    if (!citiesCache[p]) {
      try {
        const res = await listCitiesByProvince(p)
        citiesCache[p] = (res as any).data || res || []
      } catch { 
        citiesCache[p] = [] 
      }
    }
    if (citiesCache[p].includes(city)) {
      addrProvince.value = p
      cities.value = citiesCache[p]
      return
    }
  }
}

onMounted(() => {
  fetchAll()
})
</script>

<style scoped>
.users-page {
  padding: 24px;
  background: #f5f7fa;
  min-height: calc(100vh - 60px);
}

/* È°µÈù¢Ê†áÈ¢ò */
.page-header {
  margin-bottom: 24px;
}

.header-content h1 {
  margin: 0 0 4px 0;
  font-size: 28px;
  font-weight: 600;
  color: #303133;
}

.header-content p {
  margin: 0;
  font-size: 16px;
  color: #909399;
}

/* Êìç‰ΩúÂç°Áâá */
.action-card {
  margin-bottom: 16px;
  border: none;
  border-radius: 12px;
}

.action-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 16px;
}

.button-group {
  display: flex;
  gap: 12px;
}

/* Ë°®Ê†ºÂç°Áâá */
.table-card {
  border: none;
  border-radius: 12px;
}

.table-card :deep(.el-card__body) {
  padding: 0;
}

.table-card :deep(.el-table) {
  border-radius: 12px;
}

.table-card :deep(.el-table th) {
  background-color: #fafafa;
  color: #606266;
  font-weight: 600;
  border: none;
}

.table-card :deep(.el-table td) {
  border: none;
  padding: 16px 12px;
}

.action-buttons {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.action-buttons .el-button {
  margin: 0;
}

/* ÂºπÁ™óÊ†∑Âºè */
.dialog-footer {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
}

/* Âú∞ÂùÄÁÆ°ÁêÜÂºπÁ™ó‰ºòÂåñ */
.address-dialog :deep(.el-dialog__body) {
  padding: 20px 24px;
}

.address-manager {
  min-height: 500px;
}

/* È°∂ÈÉ®Êìç‰ΩúÊ†è */
.manager-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 24px;
  padding: 20px;
  background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  border-radius: 12px;
  color: white;
}

.header-info h3 {
  margin: 0 0 8px 0;
  font-size: 20px;
  font-weight: 600;
}

.header-info p {
  margin: 0;
  font-size: 14px;
  opacity: 0.9;
}

.manager-header .el-button {
  background: rgba(255, 255, 255, 0.2);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
}

.manager-header .el-button:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* Âú∞ÂùÄÂàóË°®Âå∫Âüü */
.address-list-section {
  margin-bottom: 24px;
}

.address-table {
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.address-table :deep(.el-table__header) {
  background-color: #f8f9fa;
}

.address-table :deep(.el-table th) {
  background-color: #f8f9fa;
  color: #495057;
  font-weight: 600;
  border: none;
}

.address-table :deep(.el-table td) {
  border: none;
  padding: 16px 12px;
}

.location-text {
  color: #409eff;
  font-weight: 500;
}

.table-actions {
  display: flex;
  gap: 8px;
  justify-content: center;
}

.text-muted {
  color: #909399;
}

/* Âú∞ÂùÄË°®ÂçïÂå∫Âüü */
.address-form-section {
  background: #f8f9fa;
  border-radius: 12px;
  padding: 24px;
  border: 1px solid #e9ecef;
}

.form-header {
  margin-bottom: 20px;
  padding-bottom: 12px;
  border-bottom: 2px solid #e9ecef;
}

.form-header h4 {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
  color: #495057;
}

.address-form :deep(.el-form-item__label) {
  color: #495057;
  font-weight: 500;
}

.address-form :deep(.el-input__wrapper) {
  border-radius: 8px;
}

.address-form :deep(.el-select) {
  width: 100%;
}

.address-form :deep(.el-textarea__inner) {
  border-radius: 8px;
}

/* ÈªòËÆ§Âú∞ÂùÄÂºÄÂÖ≥ */
.default-switch {
  display: flex;
  align-items: center;
  gap: 12px;
}

.switch-tip {
  font-size: 12px;
  color: #909399;
  line-height: 1.4;
}

/* Ë°®ÂçïÊìç‰ΩúÊåâÈíÆ */
.form-actions {
  margin-top: 32px;
  margin-bottom: 0;
  padding-top: 20px;
  border-top: 1px solid #e9ecef;
}

.form-actions .action-buttons {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
}

/* ÂìçÂ∫îÂºèËÆæËÆ° */
@media (max-width: 768px) {
  .users-page {
    padding: 16px;
  }

  .header-content h1 {
    font-size: 24px;
  }

  .action-bar {
    flex-direction: column;
    align-items: stretch;
  }

  .search-area {
    width: 100%;
  }

  .search-area .el-input {
    width: 100% !important;
  }

  .button-group {
    justify-content: center;
  }

  .action-buttons {
    flex-direction: column;
    gap: 4px;
  }

  .action-buttons .el-button {
    width: 100%;
    justify-content: flex-start;
  }

  .manager-header {
    flex-direction: column;
    gap: 16px;
    text-align: center;
  }

  .address-form-section {
    padding: 16px;
  }

  .form-actions .action-buttons {
    flex-direction: column;
  }

  .form-actions .action-buttons .el-button {
    width: 100%;
  }
}

@media (max-width: 480px) {
  .button-group {
    flex-direction: column;
  }

  .button-group .el-button {
    width: 100%;
  }

  .table-actions {
    flex-direction: column;
    gap: 4px;
  }

  .table-actions .el-button {
    width: 100%;
  }
}
</style>